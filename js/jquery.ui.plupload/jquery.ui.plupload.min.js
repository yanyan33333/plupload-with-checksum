;(function(e,t,n,r,i){function u(e){return n.translate(e)||e}function a(e){e.html('<div class="plupload_wrapper"><div class="ui-widget-content plupload_container"><div class="ui-state-default ui-widget-header plupload_header"><div class="plupload_header_content"><div class="plupload_logo"> </div><div class="plupload_header_title">'+u("Select files")+"</div>"+'<div class="plupload_header_text">'+u("Add files to the upload queue and click the start button.")+"</div>"+'<div class="plupload_view_switch">'+'<input type="radio" id="plupload_view_list" name="view_mode" checked="checked" /> <label class="plupload_button" for="plupload_view_list">List</label>'+'<input type="radio" id="plupload_view_thumbs" name="view_mode" /> <label class="plupload_button"  for="plupload_view_thumbs">Thumbnails</label>'+"</div>"+"</div>"+"</div>"+'<table class="plupload_filelist plupload_filelist_header ui-widget-header">'+"<tr>"+'<td class="plupload_cell plupload_file_name">'+u("Filename")+"</td>"+'<td class="plupload_cell plupload_file_status">'+u("Status")+"</td>"+'<td class="plupload_cell plupload_file_size">'+u("Size")+"</td>"+'<td class="plupload_cell plupload_file_action">&nbsp;</td>'+"</tr>"+"</table>"+'<div class="plupload_content">'+'<div class="plupload_droptext">'+u("Drag files here.")+"</div>"+'<ul class="plupload_filelist_content"> </ul>'+'<div class="plupload_clearer">&nbsp;</div>'+"</div>"+'<table class="plupload_filelist plupload_filelist_footer ui-widget-header">'+"<tr>"+'<td class="plupload_cell plupload_file_name">'+'<div class="plupload_buttons"><!-- Visible -->'+'<a class="plupload_button plupload_add">'+u("Add Files")+"</a>&nbsp;"+'<a class="plupload_button plupload_start">'+u("Start Upload")+"</a>&nbsp;"+'<a class="plupload_button plupload_stop plupload_hidden">'+u("Stop Upload")+"</a>&nbsp;"+"</div>"+'<div class="plupload_started plupload_hidden"><!-- Hidden -->'+'<div class="plupload_progress plupload_right">'+'<div class="plupload_progress_container"></div>'+"</div>"+'<div class="plupload_cell plupload_upload_status"></div>'+'<div class="plupload_clearer">&nbsp;</div>'+"</div>"+"</td>"+'<td class="plupload_file_status"><span class="plupload_total_status">0%</span></td>'+'<td class="plupload_file_size"><span class="plupload_total_file_size">0 kb</span></td>'+'<td class="plupload_file_action"></td>'+"</tr>"+"</table>"+"</div>"+'<input class="plupload_count" value="0" type="hidden">'+"</div>")}var s={};r.widget("ui.plupload",{imgs:{},contents_bak:"",options:{browse_button_hover:"ui-state-hover",browse_button_active:"ui-state-active",dragdrop:!0,multiple_queues:!0,buttons:{browse:!0,start:!0,stop:!0},views:{list:!0,thumbs:!1},default_view:"list",remember_view:!0,autostart:!1,sortable:!1,rename:!1,max_file_count:0},FILE_COUNT_ERROR:-9001,_create:function(){var e=this,t,i;t=this.element.attr("id"),t||(t=n.guid(),this.element.attr("id",t)),this.id=t,this.contents_bak=this.element.html(),a(this.element),this.container=r(".plupload_container",this.element).attr("id",t+"_container"),this.content=r(".plupload_content",this.element),r.fn.resizable&&this.container.resizable({handles:"s",minHeight:300}),this.filelist=r(".plupload_filelist_content",this.container).attr({id:t+"_filelist",unselectable:"on"}),this.browse_button=r(".plupload_add",this.container).attr("id",t+"_browse"),this.start_button=r(".plupload_start",this.container).attr("id",t+"_start"),this.stop_button=r(".plupload_stop",this.container).attr("id",t+"_stop"),r.ui.button&&(this.browse_button.button({icons:{primary:"ui-icon-circle-plus"},disabled:!0}),this.start_button.button({icons:{primary:"ui-icon-circle-arrow-e"},disabled:!0}),this.stop_button.button({icons:{primary:"ui-icon-circle-close"}})),this.progressbar=r(".plupload_progress_container",this.container),r.ui.progressbar&&this.progressbar.progressbar(),this.counter=r(".plupload_count",this.element).attr({id:t+"_count",name:t+"_count"}),this._initUploader()},_initUploader:function(){var e=this,t=this.id,i=r(".plupload_buttons",this.element).attr("id",t+"_buttons"),a,f={container:t+"_buttons",browse_button:t+"_browse"};e.options.dragdrop&&(this.filelist.parent().attr("id",this.id+"_dropbox"),f.drop_element=this.id+"_dropbox"),e.options.views.thumbs&&(o.typeOf(e.options.required_features)==="string"?e.options.required_features+=",display_media":e.options.required_features="display_media"),a=this.uploader=s[t]=new n.Uploader(r.extend(this.options,f)),a.bind("Error",function(t,r){r.code===n.INIT_ERROR&&e.destroy()}),a.bind("PostInit",function(t,n){e.options.buttons.browse?e.browse_button.button("enable"):(e.browse_button.button("disable").hide(),t.disableBrowse(!0)),e.options.buttons.start||e.start_button.button("disable").hide(),e.options.buttons.stop||e.stop_button.button("disable").hide(),!e.options.unique_names&&e.options.rename&&e._enableRenaming(),e.options.dragdrop&&t.features.dragdrop&&e.filelist.parent().addClass("plupload_dropbox"),e._enableViewSwitcher(),e.start_button.click(function(t){r(this).button("option","disabled")||e.start(),t.preventDefault()}),e.stop_button.click(function(t){e.stop(),t.preventDefault()}),e._trigger("ready",null,{up:t})}),e.options.max_file_count&&a.bind("FilesAdded",function(t,n){var r=[],i=n.length,s=t.files.length+i-e.options.max_file_count;s>0&&(r=n.splice(i-s,s),t.trigger("Error",{code:e.FILE_COUNT_ERROR,message:u("File count error."),file:r}))}),a.init(),a.bind("FilesAdded",function(t,n){e._addFiles(n),e._trigger("selected",null,{up:t,files:n}),e.options.autostart&&setTimeout(function(){e.start()},10)}),a.bind("FilesRemoved",function(t,n){e._trigger("removed",null,{up:t,files:n})}),a.bind("QueueChanged",function(){e._updateTotalProgress()}),a.bind("StateChanged",function(){e._handleState()}),a.bind("UploadFile",function(t,n){e._handleFileStatus(n)}),a.bind("FileUploaded",function(t,n){e._handleFileStatus(n),e._trigger("uploaded",null,{up:t,file:n})}),a.bind("UploadProgress",function(t,n){e._handleFileStatus(n),e._updateTotalProgress(),e._trigger("progress",null,{up:t,file:n})}),a.bind("UploadComplete",function(t,n){e._trigger("complete",null,{up:t,files:n})}),a.bind("Error",function(t,r){var i=r.file,s,o;if(i){s="<strong>"+r.message+"</strong>",o=r.details;if(o)s+=" <br /><i>"+r.details+"</i>";else{switch(r.code){case n.FILE_EXTENSION_ERROR:o=u("File: %s").replace("%s",i.name);break;case n.FILE_SIZE_ERROR:o=u("File: %f, size: %s, max file size: %m").replace(/%([fsm])/g,function(t,r){switch(r){case"f":return i.name;case"s":return i.size;case"m":return n.parseSize(e.options.max_file_size)}});break;case n.FILE_DUPLICATE_ERROR:o=u("%s already present in the queue.").replace(/%s/,i.name);break;case e.FILE_COUNT_ERROR:o=u("Upload element accepts only %d file(s) at a time. Extra files were stripped.").replace("%d",e.options.max_file_count);break;case n.IMAGE_FORMAT_ERROR:o=u("Image format either wrong or not supported.");break;case n.IMAGE_MEMORY_ERROR:o=u("Runtime ran out of available memory.");break;case n.HTTP_ERROR:o=u("Upload URL might be wrong or doesn't exist.")}s+=" <br /><i>"+o+"</i>"}e.notify("error",s),e._trigger("error",null,{up:t,file:i,error:s})}})},_setOption:function(e,t){var n=this;e=="buttons"&&typeof t=="object"&&(t=r.extend(n.options.buttons,t),t.browse?(n.browse_button.button("enable").show(),up.disableBrowse(!1)):(n.browse_button.button("disable").hide(),up.disableBrowse(!0)),t.start?n.start_button.button("enable").show():n.start_button.button("disable").hide(),t.stop?n.start_button.button("enable").show():n.stop_button.button("disable").hide()),n.uploader.settings[e]=t},start:function(){this.uploader.start(),this._trigger("start",null)},stop:function(){this.uploader.stop(),this._trigger("stop",null)},enable:function(){self.browse_button.button("enable"),this.uploader.disableBrowse(!1)},disable:function(){this.browse_button.button("disable"),this.uploader.disableBrowse(!0)},getFile:function(e){var t;return typeof e=="number"?t=this.uploader.files[e]:t=this.uploader.getFile(e),t},removeFile:function(e){n.typeOf(e)==="string"&&(e=this.getFile(id)),this._removeFiles(e)},clearQueue:function(){this.uploader.splice()},getUploader:function(){return this.uploader},refresh:function(){this.uploader.refresh()},notify:function(e,t){var n=r('<div class="plupload_message"><span class="plupload_message_close ui-icon ui-icon-circle-close" title="'+u("Close")+'"></span>'+'<p><span class="ui-icon"></span>'+t+"</p>"+"</div>");n.addClass("ui-state-"+(e==="error"?"error":"highlight")).find("p .ui-icon").addClass("ui-icon-"+(e==="error"?"alert":"info")).end().find(".plupload_message_close").click(function(){n.remove()}).end(),r(".plupload_header",this.container).append(n)},destroy:function(){this._removeFiles([].slice.call(this.uploader.files)),this.uploader.destroy(),r(".plupload_button",this.element).unbind(),r.ui.button&&r(".plupload_add, .plupload_start, .plupload_stop",this.container).button("destroy"),r.ui.progressbar&&this.progressbar.progressbar("destroy"),r.ui.sortable&&this.options.sortable&&r("tbody",this.filelist).sortable("destroy"),this.element.empty().html(this.contents_bak),this.contents_bak="",r.Widget.prototype.destroy.apply(this)},_handleState:function(){var e=this,t=this.uploader;t.state===n.STARTED?(r(e.start_button).button("disable"),r([]).add(e.stop_button).add(".plupload_started").removeClass("plupload_hidden"),r(".plupload_upload_status",e.element).html(u("Uploaded %d/%d files").replace("%d/%d",t.total.uploaded+"/"+t.files.length)),r(".plupload_header_content",e.element).addClass("plupload_header_content_bw")):(r([]).add(e.stop_button).add(".plupload_started").addClass("plupload_hidden"),e.options.multiple_queues&&(r(e.start_button).button("enable"),r(".plupload_header_content",e.element).removeClass("plupload_header_content_bw")),e._updateTotalProgress())},_handleFileStatus:function(e){function o(){var i="",s=parseInt(t.counter.val()||0,10),o=t.id+"_"+s;e.target_name&&(i+='<input type="hidden" name="'+o+'_tmpname" value="'+n.xmlEncode(e.target_name)+'" />'),i+='<input type="hidden" name="'+o+'_name" value="'+n.xmlEncode(e.name)+'" />',i+='<input type="hidden" name="'+o+'_status" value="'+(e.status===n.DONE?"done":"failed")+'" />',r("#"+e.id).find(".plupload_file_fields").html(i),t.counter.val(++s)}var t=this,i,s;if(!r("#"+e.id).length)return;switch(e.status){case n.DONE:i="plupload_done",s="ui-icon ui-icon-circle-check",o();break;case n.FAILED:i="ui-state-error plupload_failed",s="ui-icon ui-icon-alert",o();break;case n.QUEUED:i="plupload_delete",s="ui-icon ui-icon-circle-minus";break;case n.UPLOADING:i="ui-state-highlight plupload_uploading",s="ui-icon ui-icon-circle-arrow-w";var u=r(".plupload_scroll",this.container),a=u.scrollTop(),f=u.height(),l=r("#"+e.id).position().top+r("#"+e.id).height();f<l&&u.scrollTop(a+l-f),r("#"+e.id).find(".plupload_file_percent").html(e.percent+"%").end().find(".plupload_file_progress").css("width",e.percent+"%").end().find(".plupload_file_size").html(n.formatSize(e.size))}i+=" ui-state-default plupload_file",r("#"+e.id).attr("class",i).find(".ui-icon").attr("class",s).end().filter(".plupload_delete, .plupload_done").find(".ui-icon").click(function(n){t._removeFiles(e),n.preventDefault()})},_updateTotalProgress:function(){var e=this.uploader;e.total.queued===0?r(".ui-button-text",this.browse_button).html(u("Add Files")):r(".ui-button-text",this.browse_button).html(u("%d files queued").replace("%d",e.total.queued)),e.refresh(),e.files.length===e.total.uploaded+e.total.failed?this.start_button.button("disable"):this.start_button.button("enable"),this.filelist[0].scrollTop=this.filelist[0].scrollHeight,this.progressbar.progressbar("value",e.total.percent),this.element.find(".plupload_total_status").html(e.total.percent+"%").end().find(".plupload_total_file_size").html(n.formatSize(e.total.size)).end().find(".plupload_upload_status").html(u("Uploaded %d/%d files").replace("%d/%d",e.total.uploaded+"/"+e.files.length))},_addFiles:function(e){var t=this,i,s=[];i='<li class="plupload_file ui-state-default" id="%id%"><div class="plupload_file_thumb"> </div><div class="plupload_file_name" title="%name%"><span class="plupload_file_namespan">%name%</span></div><div class="plupload_file_action"><div class="ui-icon"> </div></div><div class="plupload_file_size">%size% </div><div class="plupload_file_status"><div class="plupload_file_progress ui-widget-header" style="width: 0%"> </div><span class="plupload_file_percent">%percent% </span></div><div class="plupload_clear plupload_file_fields"> </div></li>',n.typeOf(e)!=="array"&&(e=[e]),r.ui.sortable&&this.options.sortable&&r("tbody",t.filelist).sortable("destroy"),r.each(e,function(e,u){t.filelist.append(i.replace(/%(\w+)%/g,function(e,t){return"size"===t?n.formatSize(u.size):u[t]||""})),t.options.views.thumbs&&s.push(function(e){var n;n=new o.Image,n.onload=function(){n.embed(r("#"+u.id+" .plupload_file_thumb",t.filelist)[0],{width:100,height:60,crop:!0,swf_url:mOxie.resolveUrl(t.options.flash_swf_url),xap_url:mOxie.resolveUrl(t.options.silverlight_xap_url)}),setTimeout(e,1)},n.onembedded=function(){n.destroy()},n.onerror=function(){e()},n.load(u.getSource())}),t._handleFileStatus(u)}),s.length&&t._series(s),this.options.sortable&&r.ui.sortable&&this._enableSortingList(),this._trigger("updatelist",null,this.filelist)},_series:function(e,t){function i(n){o.typeOf(e[n])==="function"&&e[n](function(){++n<r?i(n):t()})}var n=0,r=e.length;o.typeOf(t)!=="function"&&(t=function(){}),i(n)},_removeFiles:function(e){var t=this,i=this.uploader;n.typeOf(e)!=="array"&&(e=[e]),r.ui.sortable&&this.options.sortable&&r("tbody",t.filelist).sortable("destroy"),r.each(e,function(e,t){t.imgs&&t.imgs.length&&(r.each(t.imgs,function(e,t){t.destroy()}),t.imgs=[]),r("#"+t.id).remove(),i.removeFile(t)}),i.files.length&&this.options.sortable&&r.ui.sortable&&this._enableSortingList(),this._trigger("updatelist",null,t.filelist)},_viewChanged:function(e){this.options.remember_view&&r.cookie&&r.cookie("plupload_ui_view",e,{expires:7,path:"/"}),mOxie.Env.browser==="IE"&&mOxie.Env.version<7&&this.content.attr("style",'height:expression(document.getElementById("'+this.id+"_container"+'").clientHeight - '+(e==="list"?133:103)+");"),this.container.removeClass("plupload_view_list plupload_view_thumbs").addClass("plupload_view_"+e),this.view_mode=e,this._trigger("viewchanged",e)},_enableViewSwitcher:function(){var e=this,t,i=r(".plupload_view_switch",this.container),s,o;r.each(e.options.views,function(e,t){t||i.find('[for="plupload_view_'+e+'"], #plupload_view_'+e).remove()}),s=i.find(".plupload_button");if(s.length===1){i.hide(),t=s.attr("for").replace(/^plupload_view_/,""),e._viewChanged(t);return}if(!(r.ui.button&&s.length>1)){i.show(),e._viewChanged(this.options.default_view);return}i.show(),i.buttonset(),i.find(".plupload_button").click(function(){t=r(this).attr("for").replace(/^plupload_view_/,""),e._viewChanged(t)}),this.options.remember_view&&r.cookie&&(t=r.cookie("plupload_ui_view")),~n.inArray(t,["list","thumbs"])||(t=this.options.default_view),o=i.find('[for="plupload_view_'+t+'"]');if(o.length){o.trigger("click");return}},_enableRenaming:function(){var e=this;this.filelist.dblclick(function(t){var n=r(t.target),i,s,o,u,a,f="";if(!n.hasClass("plupload_file_namespan"))return;s=e.uploader.getFile(n.closest(".plupload_file")[0].id),u=s.name,o=/^(.+)(\.[^.]+)$/.exec(u),o&&(u=o[1],f=o[2]),i=r('<input class="plupload_file_rename" type="text" />').width(n.width()).insertAfter(n.hide()),i.val(u).blur(function(){n.show().parent().scrollLeft(0).end().next().remove()}).keydown(function(e){var t=r(this);r.inArray(e.keyCode,[13,27])!==-1&&(e.preventDefault(),e.keyCode===13&&(s.name=t.val()+f,n.html(s.name)),t.blur())})[0].focus()})},_enableSortingList:function(){var e,t=this,n=r(".plupload_filelist_content",this.element);if(r(".plupload_file",n).length<2)return;n.sortable({items:".plupload_delete",cancel:"object, .plupload_clearer",stop:function(e,n){var i,s,o,u=[];r.each(r(this).sortable("toArray"),function(e,n){u[u.length]=t.uploader.getFile(n)}),u.unshift(u.length),u.unshift(0),Array.prototype.splice.apply(t.uploader.files,u)}})}})})(window,document,plupload,jQuery);